<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AItmosphere</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #results { margin-top: 20px; }
        #images img { max-width: 200px; margin: 5px; border: 1px solid #ccc; }
        #video-player { width: 100%; max-width: 600px; margin-top: 10px; border: 1px solid #ccc;}
        #loading { display: none; }
    </style>
</head>
<body>
    <h2>AItmosphere ğŸµğŸ¨</h2>
    <form id="generation-form">
        <label for="city">éƒ½å¸‚å (ä¾‹: Tokyo):</label>
        <input type="text" id="city" value="Tokyo" required>
        <br><br>
        <label for="text_prompt">è¿½åŠ ãƒ†ã‚­ã‚¹ãƒˆ (ä¾‹: é™ã‹ãªå¤œ):</label>
        <input type="text" id="text_prompt" value="é™ã‹ãªå¤œ" required>
        <br><br>
        <button type="submit">ç”Ÿæˆã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
    </form>

    <div id="loading">ç”Ÿæˆä¸­ã§ã™...ï¼ˆãƒ¢ãƒ‡ãƒ«ã®èµ·å‹•ã«ã¯æ•°åˆ†ã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰</div>

    <div id="results">
        <h3>ç”Ÿæˆçµæœ</h3>
        <p id="weather-info"></p>

        <h4>ğŸµ éŸ³æ¥½</h4>
        <audio id="music-player" controls></audio>

        <h4>ğŸ¨ ç”»åƒ</h4>
        <div id="images"></div>

        <h4>ğŸ¬ å‹•ç”»</h4>
        <video id="video-player" controls loop></video>
    </div>

    <script>
        document.getElementById("generation-form").addEventListener("submit", async function(e) {
            e.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            
            const city = document.getElementById("city").value;
            const text_prompt = document.getElementById("text_prompt").value;

            document.getElementById("loading").style.display = "block";
            document.getElementById("results").style.display = "none";

            try {
                const response = await fetch("/generate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        city: city,
                        text_prompt: text_prompt
                    }),
                });

                if (!response.ok) {
                    throw new Error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
                }

                const data = await response.json();

                // çµæœã‚’è¡¨ç¤º
                document.getElementById("weather-info").textContent = data.weather_info;
                document.getElementById("music-player").src = data.music_url;
                
                const videoPlayer = document.getElementById("video-player");
                videoPlayer.src = data.video_url;
                videoPlayer.load(); // æ–°ã—ã„ã‚½ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã‚€

                const imagesContainer = document.getElementById("images");
                imagesContainer.innerHTML = ""; // å‰å›ã®çµæœã‚’ã‚¯ãƒªã‚¢
                data.image_urls.forEach(url => {
                    const img = document.createElement("img");
                    img.src = url;
                    imagesContainer.appendChild(img);
                });

                document.getElementById("results").style.display = "block";

            } catch (error) {
                console.error("ã‚¨ãƒ©ãƒ¼:", error);
                alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
            } finally {
                document.getElementById("loading").style.display = "none";
            }
        });
    </script>

</body>

</html>